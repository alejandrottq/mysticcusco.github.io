<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
      <title>Pokemap Cusco, TEAM MYSTIC CUSCO OFFICIAL, pokemon go, cusco peru</title>
      <meta name="description" content="Nidos pokemon, gym de pase Ex, gyms de combate en cusco peru"/>
      <link rel="shortcut icon" href="img/nido.png">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
<link rel="stylesheet" href="style.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script src="https://cdn.rawgit.com/googlemaps/v3-utility-library/master/markerclustererplus/src/markerclusterer.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.4.0/clipboard.min.js"></script>
<!--script src="https://maps.google.com/maps/api/js?sensor=true"></script-->
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB6PTbsHpFE0ZzFsgVXy3Od1f-CRXx4YDI&callback=initMap">
</script>


<!--a href="https://github.com/rhcarlosweb/google-maps-multi-filter-jquery" target="_blank" class="repo">
    <i class="fa fa-github"></i><span>Fork</span>
</a-->
<script src="cargartabla.js"></script>
</head>

<div  class="search-form">
    <div class="form-group has-feedback searchopkform">
        <label for="search" class="sr-only">Search</label>
        <input id="pac-input" type="text" class="form-control" name="search" id="search" placeholder="Ingrese nombre o coordenadas">
        <span class="glyphicon glyphicon-search form-control-feedback"></span>
    </div>
</div>

<!-- mapa iframe -->
<div id="mapgoogle"></div>
<!-- fim mapa iframe -->

<!-- filters -->
<div id="legend">
    <form action="" id="buscar-locais">
        <div class="row">
            <div class="col-xs-12">
                <select class="form-control selectpicker" id="pais">
                    <option value="">Todos</option>
                    <option data-thumbnail="gym.png" value="gym">Gyms</option>
                    <option data-thumbnail="images/gymex.png" value="gymex">Gym Ex</option>
                    <option data-thumbnail="images/nido.png" value="nido">Nidos</option>
                    <option data-thumbnail="images/stop.png" value="stop">Misiones</option>
                </select>
            </div>
            <br>
            <div class="col-xs-12">
                <button type="submit" class=" btn btn-default btn-success" style="width: 100%;margin-top: 7px;">
                   <span class="glyphicon glyphicon-search"></span> Buscar
                </button>
            </div>
        </div>
    </form>
</div>
<!-- end filters -->


<!-- Button trigger modal -->
<button style="display: none;" type="button" class="btn btn-primary" id="MdBottom" data-toggle="modal" data-target="#exampleModal">
  Add New
</button>

<!-- Modal -->
<div class="modal fade bd-example-modal-lg" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">AÑADIR, EDITAR O ELIMINAR</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div class="row">
        <div class="col-md-12 ml-auto">
             <form>
              <div class="form-group">
                <label for="recipient-name" class="col-form-label">Nombre:</label>
                <input type="text" class="form-control" id="recipient-name">
              </div>
              <div class="form-group">
                <label for="recipient-name" class="col-form-label">Tipo:</label>
                <input type="text" class="form-control" id="recipient-name">
              </div>
              <div class="form-group">
                <label for="recipient-name" class="col-form-label">Longitud:</label>
                <input type="text" class="form-control" id="recipient-name">
              </div>
              <div class="form-group">
                <label for="recipient-name" class="col-form-label">Latitud:</label>
                <input type="text" class="form-control" id="recipient-name">
              </div>
            </form>
        </div>
        <div class="col-md-12 ml-auto"><h5>DATOS RECOPILADOS</h5></div>
            <div id="tabla-casificacion">
                <table class="table">
                    <thead>
                        <tr>
                            <th>Nombre</th>
                            <th>Tipo</th>
                            <th>Long</th>
                            <th>Lat</th>
                        </tr>
                    </thead>
                    <tbody id="equipos-tabla">
                        
                        
                    </tbody>
                </table>
            </div>

            <button type="button" class="btn btn-secondary" id="mostrar-tabla">Mostrar tabla</button>
        </div>
       
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
        <button type="button" class="btn btn-primary">Guardar</button>
      </div>
    </div>
  </div>
</div>







<script>

 (function(){
    new Clipboard('#copy-button');
})();

jQuery.noConflict();
jQuery(document).ready(function ($) {
    // map
    var map;

    // marcadores / lojas e pontos de distribuição no mapa
    var markers = [];

    // cluster var para agrupar marcadores próximos em zoom pequeno
    var mc;
    
    // bounds / função limites do mapa
    var bounds = new google.maps.LatLngBounds();
    
    

    /**
     * Função inicializar mapa
     */
    function initMap() {
        // localização inicial
        var myLatlng = new google.maps.LatLng(
            -13.531379,-71.952026
        );

        // opções mapa inicial
        var mapOptions = {
            zoom: 14, // zoom inicial mapa
            maxZoom: 21, // zoom máximo
            center: myLatlng, // localização inicial
            draggable : true,
            scrollwheel: true,
            panControl: true,
            streetViewControl: false,
            scaleControl: true,
            mapTypeControl: false,
            overviewMapControl: true,
            mapTypeId: google.maps.MapTypeId.ROADMAP, // tipo de mapa
            styles:[
                  {
                    "featureType": "poi.business",
                    "stylers": [
                      {
                        "visibility": "off"
                      }
                    ]
                  },
                  {
                    "featureType": "road",
                    "elementType": "labels.icon",
                    "stylers": [
                      {
                        "visibility": "off"
                      }
                    ]
                  },
                  {
                    "featureType": "transit",
                    "stylers": [
                      {
                        "visibility": "off"
                      }
                    ]
                  }
                ]
        };

        // registra mapa na div #mapa como variável mapgoogle
        map = new google.maps.Map(document.getElementById("mapgoogle"), mapOptions);

        // Extrai informações do locais.json para criar marcadores
        $.getJSON(mapJsonFile, function (stores, textStatus) {
            // loop para criar marcadores no mapa usando
            // função addMarker()
            // para cada array em stores tem informações de um store
            $.each(stores, function (i, store) {                
                addMarker(store);
            });

            // cluster config
            // ajustes para exibição de ícone com marcadores agrupados
            var optionsCluster = {
                maxZoom: 13, // máximo zoom exibido cluster
                styles: [
                    {
                        textColor: '#ffffff', // cor texto cluster
                        url: 'https://developers.google.com/maps/documentation/javascript/examples/markerclusterer/m1.png', // imagem fundo do cluster
                        width: 53, // largura da imagem
                        height: 52 // altura da imagem
                    }
                ]
            };        

            // suporte a clusters adicionado ao map
            // map = variável do mapa
            // markers = array de marcadores
            // optionsCluster = options do cluster configurados acima
            mc = new MarkerClusterer(map, markers, optionsCluster);
            
            // zoom para todos marcadores visíveis no ínicio
            // if (bounds.f.b != 1 && bounds.f.f != -1) {
            //     // map.fitBounds(bounds);
            // }
        });
    }

    /**
     * Função para registro de marcadores
     */
    function addMarker(markerinfo) {
        // titulo do marcador
        var title = markerinfo.name;
        if (title === null) { title = ''; }

        // endereco completo do marcador, deixa em branco se não há
        var address = markerinfo.location.full_address;
        if (address === null) { address = ''; }

        // telefone do marcador, deixar em branco se não há
        //var phone = markerinfo.phone;
        //if (phone === null) { phone = ''; }

        // pais do marcador
        var country = markerinfo.location.country.slug;
        
        // estado do marcador
        //var state = markerinfo.location.state.slug;

        // cidade do marcador
        //var city = markerinfo.location.city.slug;

        // setor do marcador
        //var district = markerinfo.location.district.slug;
        
        // tipo do marcador
        //var type = markerinfo.type.slug;

        // todas categorias em um array
        var categories = [
            country
        ];

        // posição lat e lng do marcador
        var position = new google.maps.LatLng(markerinfo.location.coordinates.lat, markerinfo.location.coordinates.lng);

        // imagens de marcadores personalizados
        //var image_point = "https://cdn.rawgit.com/rhcarlosweb/google-maps-markers/9cafdad0/assets/images/ponto.png";
        //var image_store = "https://cdn.rawgit.com/rhcarlosweb/google-maps-markers/9cafdad0/assets/images/loja.png";
        var gym = "img/gym.png";
        var gymex = "img/gymex.png";
        var nido = "img/nido.png";
        var stop = "img/stop.png";

        // imagem marcadores personalizados para cada tipo de local
        var icons = {
            gym: {icon: gym},
            gymex: {icon: gymex},
            stop: {icon: stop},
            nido: {icon: nido}
        };

        // registro de marcadores
        var marker = new google.maps.Marker({
            title: title, // titulo marcador
            position: position, // posicao marcador
            icon: icons[markerinfo.location.country.slug].icon, // usa icone certo para cada tipo de marcador
            animation: google.maps.Animation.DROP, // animação drop marcador
            map: map, // registra marcador na variável map
            category: categories
        });
        
        // adiciona markers ao array
        markers.push(marker);

        // limite adicionado com posição de cada marcador
        bounds.extend(marker.position);

        // registro de conteúdo na caixa de informações
        // do marcador
        var infowindow = new google.maps.InfoWindow({
            content: '<div class="title-map"><h5>' + title + '</h5></div>' + '<div class="endereco"><input style="border: 0;margin-right: 6px;" id="foo" value="' + address + '"><button id="copy-button" class="" data-clipboard-target="#foo"><img width="12px" src="https://clipboardjs.com/assets/images/clippy.svg" alt="Copy to clipboard" title="Copy to clipboard"></button></div>'
        });

        // exibe marcador quando clicado
        marker.addListener('click', function () {
            // zoom no marcador
            // map.setZoom(14);

            // centraliza mapa na posição do marcador
            // map.setCenter(marker.getPosition());
            
            // abre caixa informações marcador
            infowindow.open(map, marker);
        });

        // Exibe marcador quando hover
        // marker.addListener('mouseover', function() {
        //     infowindow.open(map, marker);
        // });
        // marker.addListener('mouseout', function() {
        //     infowindow.close();
        // });

    }

    /**
     * Form filtro
     */
    $('#buscar-locais').submit(function(event) {
        event.preventDefault();
        
        // valores filtros selecionado
        var countryValSel = [
            $('#pais').val(),
        ];

        // limite do mapa
        bounds = new google.maps.LatLngBounds();

        for (i = 0; i < markers.length; i++) {
            // addMarker(markers[i]);
            
            var mark = markers[i];

            // If is same category or category not picked
            // if ((typeof mark.category == 'object' && mark.category.indexOf(countryValSel) >= 0) || countryValSel.length === 0) {
            if (objectsMatch(mark.category, countryValSel) || countryValSel.length === 0) {
                mark.setVisible(true);
                mc.setIgnoreHidden(true);
                bounds.extend(mark.getPosition());
            }
            // Categories don't match 
            else {                
                mc.setIgnoreHidden(true);
                mark.setVisible(false);
            }

        }

        // zoom mapa aos marcadores selecionados com 
        // a categoria
        map.fitBounds(bounds);
    });

    // init map on load page
    $(window).load(function () {
        initMap();
    });


    /**
     * Função verifica se objetos são identicos
     */
    function objectsMatch(roll, filterObject) {
        var match = true;
        for (var prop in filterObject) {
            if (!roll.hasOwnProperty(prop) ||
                !filterObject.hasOwnProperty(prop)) continue;
            if (roll[prop] != filterObject[prop] &&
                filterObject[prop] !== ''
            ) {
                match = false;
            }
        }
        return match;
    }

});





// Create the search box and link it to the UI element.
        var input = document.getElementById('pac-input');
        var searchBox = new google.maps.places.SearchBox(input);
        map.controls[google.maps.ControlPosition.TOP_LEFT].push(input);

        // Bias the SearchBox results towards current map's viewport.
        map.addListener('bounds_changed', function() {
          searchBox.setBounds(map.getBounds());
        });
</script>